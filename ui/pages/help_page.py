from PySide6 import QtWidgets, QtCore, QtGui

class HelpPage(QtWidgets.QWidget):
    """Страница помощи с информацией о приложении"""
    
    def __init__(self):
        super().__init__()
        
        # Создаем основной layout
        main_layout = QtWidgets.QVBoxLayout(self)
        
        # Заголовок
        title_label = QtWidgets.QLabel("Справка по работе с приложением")
        title_label.setAlignment(QtCore.Qt.AlignCenter)
        font = title_label.font()
        font.setPointSize(16)
        font.setBold(True)
        title_label.setFont(font)
        main_layout.addWidget(title_label)
        
        # Создаем скроллируемую область для текста справки
        scroll_area = QtWidgets.QScrollArea()
        scroll_area.setWidgetResizable(True)
        scroll_area.setFrameShape(QtWidgets.QFrame.NoFrame)
        
        # Создаем виджет с содержимым справки
        help_content = QtWidgets.QWidget()
        help_layout = QtWidgets.QVBoxLayout(help_content)
        
        # Добавляем разделы справки
        self.add_section(help_layout, "Общая информация", [
            "Приложение предназначено для работы с данными о фьючерсах FUSD.",
            "Основные функции приложения:",
            "• Просмотр и редактирование данных о торгах и датах исполнения",
            "• Анализ логарифма изменения цены фьючерса",
            "• Расчет статистических характеристик",
            "• Визуализация данных на графиках"
        ])
        
        self.add_section(help_layout, "Работа с таблицами", [
            "Раздел \"Таблица\" содержит три вкладки:",
            "1. Первая таблица (торги) - информация о торгах фьючерсами",
            "2. Вторая таблица (исполнения) - информация о датах исполнения фьючерсов",
            "3. Третья таблица (совмещённая) - объединенная информация о торгах и исполнениях",
            "",
            "Функции управления таблицами:",
            "• Добавить - добавление новой записи",
            "• Изменить - редактирование выбранной записи",
            "• Удалить - удаление записи или записей",
            "",
            "Для сортировки таблицы по разным полям используйте переключатель \"Сортировка\".",
            "Для быстрого анализа данных выделите строку в таблице - информация будет автоматически",
            "перенесена на вкладку \"Анализ\"."
        ])
        
        self.add_section(help_layout, "Анализ данных", [
            "Раздел \"Анализ\" позволяет рассчитать и визуализировать логарифм изменения цены фьючерса.",
            "",
            "Параметры анализа:",
            "• Дата анализа - дата, на которую производится анализ",
            "• Код фьючерса - выбор фьючерса для анализа",
            "• Период предыстории - количество календарных дней для анализа",
            "",
            "Результаты анализа представлены в трех вкладках:",
            "1. График - визуализация изменения логарифма цены фьючерса",
            "2. Статистика - основные статистические характеристики",
            "3. Отчет - текстовый отчет с результатами анализа",
            "",
            "Для экспорта отчета в текстовый файл используйте кнопку \"Экспорт отчета\"."
        ])
        
        self.add_section(help_layout, "Формат кода фьючерса", [
            "Код фьючерса имеет формат FUSD_MM_YY, где:",
            "• FUSD - префикс, обозначающий фьючерс на доллар США",
            "• MM - месяц исполнения (01-12)",
            "• YY - год исполнения (две последние цифры года в 20-м веке)",
            "",
            "Пример: FUSD_06_96 - фьючерс на доллар США с исполнением в июне 1996 года."
        ])
        
        self.add_section(help_layout, "Расчет логарифма изменения цены", [
            "Для каждого фьючерса Fk в каждый торговый день рассчитывается логарифм изменения цены:",
            "",
            "xk(i) = ln{ Fk(i) / Fk(i-2)}",
            "",
            "где i - порядковый номер торгового дня.",
            "",
            "Количество торговых дней - это число дней в выбранном периоде предыстории,",
            "для которых есть данные о торгах и можно рассчитать логарифм изменения цены.",
            "Для расчета требуется минимум 3 торговых дня."
        ])
        
        self.add_section(help_layout, "Горячие клавиши", [
            "Tab - активация автодополнения кода фьючерса",
            "Enter - подтверждение ввода в диалогах",
            "Escape - отмена операции/закрытие диалога"
        ])
        
        # Добавляем виджет с содержимым в скроллируемую область
        scroll_area.setWidget(help_content)
        main_layout.addWidget(scroll_area)

    def add_section(self, layout, title, content_lines):
        """Добавляет раздел справки с заголовком и содержимым"""
        # Заголовок раздела
        section_title = QtWidgets.QLabel(title)
        font = section_title.font()
        font.setPointSize(14)
        font.setBold(True)
        section_title.setFont(font)
        layout.addWidget(section_title)
        
        # Содержимое раздела
        content = QtWidgets.QLabel("\n".join(content_lines))
        content.setWordWrap(True)
        content.setTextFormat(QtCore.Qt.RichText)
        layout.addWidget(content)
        
        # Разделитель
        line = QtWidgets.QFrame()
        line.setFrameShape(QtWidgets.QFrame.HLine)
        line.setFrameShadow(QtWidgets.QFrame.Sunken)
        layout.addWidget(line)
        
        # Отступ после раздела
        layout.addSpacing(10)
